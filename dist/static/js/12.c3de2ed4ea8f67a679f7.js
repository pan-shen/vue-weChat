webpackJsonp([12],{jdiW:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("GKmE"),i=a("AZ7y"),o={name:"login",components:{captchaBox:a("Wuyz").a},data:function(){return{currentMethod:"pwdLogin",password:"",vCode:"",captchaToken:"",timeOut:!1,leftTime:60,getCodeText:"获取验证码",timer:null,disabled:!0,pwdHidden:!0,showCaptcha:!1,showRegister:!1,userName:"",code:"",name:"",authInfo:null}},watch:{userName:function(){this.handleClick()},password:function(){this.handleClick()},vCode:function(){this.handleClick()},leftTime:function(t,e){t<=0&&(clearInterval(this.timer),this.getCodeText="重新获取",this.leftTime=60,this.timeOut=!1)}},created:function(){this.code=i.a.getUrlStr("code");var t=Object(s.c)("authInfo");this.authInfo=JSON.parse(JSON.parse(t))},methods:{switchShow:function(){this.pwdHidden=!this.pwdHidden},handleClick:function(){this.userName.length>0&&(this.password.length>0||this.vCode.length>0)?this.disabled=!1:this.disabled=!0},setTimeOut:function(){var t=this;this.timeOut=!0,this.timer=setInterval(function(){t.leftTime-=1},1e3)},handleLogin:function(t,e,a,i,o,n){var r=this;this.$http.post("/hospital/login/",{userName:t,password:e,authInfo:a,type:i?"verifyCode":"password",verificationCode:i||null}).then(function(t){o&&o(),0==t.data.rc?(console.log(t.data),r.code=t.data.data.token.code,r.name=t.data.data.userinfo.userName,Object(s.d)("isLogin",!0),Object(s.d)("Authorization","Base "+t.data.data.token.data),Object(s.d)("realName",t.data.data.userinfo.realName),Object(s.d)("userName",t.data.data.userinfo.userName),r.$route.query.target?setTimeout(function(){r.$router.replace(decodeURIComponent(r.$route.query.target))},1e3):t.data.data.userinfo.isActivating&&setTimeout(function(){r.$toast({type:"text",message:"登录成功",duration:1e3}),r.$router.push("/appointment/make/date")},1e3)):1004==t.data.rc?(r.$toast({type:"text",message:t.data.msg,duration:1e3}),setTimeout(function(){r.$router.push("/user/register/unBind")},1e3)):r.$toast({type:"text",message:t.data.msg,duration:1e3})}).catch(function(t){n&&n()})},handleBind:function(t){this.$http.get("/hospital/login/is-need-bind?userName="+t,{}).then(function(t){console.log(t)}).catch(function(t){console.log(t)})},confirmLogin:function(t){if("pwdLogin"===this.currentMethod)if(this.password.length>0){t.target.innerText="登录中...";var e=this.$toast({type:"loading",duration:1e3,message:"登录中...",shadow:!0});this.handleLogin(this.userName,this.password,this.authInfo,null,function(){e.close()},function(){e.close()})}else this.$toast({type:"text",message:"请输入密码！"});else if("codeLogin"===this.currentMethod)if(this.vCode.length>0){t.target.innerText="登录";e=this.$toast({type:"loading",message:"正在登录",duration:0,shadow:!0});this.handleLogin(this.userName,null,this.authInfo,this.vCode,function(){e.close(),t.target.innerText="登录"})}else this.$toast({type:"text",message:"请输入验证码！"})},getCode:function(){var t=this;Object(s.a)(this.userName)&&60===this.leftTime?this.$http.get("/hospital/login/verify-mobile-phone?mobilePhone="+this.userName,{}).then(function(e){e.data.data.isRegister?t.$http.post("/hospital/login/get-verification-code",{mobilePhone:t.userName}).then(function(e){0===e.data.rc?e.data.data.isHaveCaptcha?(t.captchaToken=e.data.data.captchaToken,t.showCaptcha=!0):(t.$toast({message:"验证码获取成功"}),t.setTimeOut()):t.$toast({type:"text",message:e.data.msg})}):t.$toast({message:"手机号未注册"})}):this.$toast({type:"text",message:"请输入正确手机号"})},verifySuccess:function(){console.log("验证成功"),this.setTimeOut()},hideCaptcha:function(t){this.showCaptcha=!t}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-container"},[t._m(0),t._v(" "),a("div",{staticClass:"login-box"},[a("div",{staticClass:"tab-switch"},[a("span",{class:"pwdLogin"===t.currentMethod?"active":"",on:{click:function(e){t.currentMethod="pwdLogin"}}},[t._v("账号密码登录")]),t._v(" "),a("span",{class:"codeLogin"===t.currentMethod?"active":"",on:{click:function(e){t.currentMethod="codeLogin"}}},[t._v("验证码登录")])]),t._v(" "),a("div",{staticClass:"switch-list"},["pwdLogin"===t.currentMethod?a("div",{staticClass:"switch-list_item pwdLogin"},[a("div",{staticClass:"input-box"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.userName,expression:"userName"}],attrs:{type:"number",placeholder:"请输入手机号",maxlength:"11"},domProps:{value:t.userName},on:{input:function(e){e.target.composing||(t.userName=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"input-box"},[t.pwdHidden?a("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:"请输入密码",maxlength:"16"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}):t._e(),t._v(" "),t.pwdHidden?t._e():a("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"email",placeholder:"请输入密码",maxlength:"16"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),t._v(" "),a("div",{staticClass:"see-icon",class:t.pwdHidden?"hidden":"",on:{click:t.switchShow}})])]):t._e(),t._v(" "),"codeLogin"===t.currentMethod?a("div",{staticClass:"switch-list_item codeLogin"},[a("div",{staticClass:"input-box"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.userName,expression:"userName"}],attrs:{type:"number",placeholder:"请输入手机号",maxlength:"11"},domProps:{value:t.userName},on:{input:function(e){e.target.composing||(t.userName=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"input-box"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.vCode,expression:"vCode"}],attrs:{type:"number",placeholder:"请输入验证码"},domProps:{value:t.vCode},on:{input:function(e){e.target.composing||(t.vCode=e.target.value)}}}),t._v(" "),t.timeOut?a("span",{staticStyle:{color:"#00bd93"}},[t._v("已发送（"+t._s(t.leftTime)+"s）")]):t._e(),t._v(" "),t.timeOut?t._e():a("span",{staticClass:"reget",on:{click:t.getCode}},[t._v(t._s(t.getCodeText))])])]):t._e()]),t._v(" "),a("button",{staticClass:"confirm-button",attrs:{disabled:t.disabled},on:{click:t.confirmLogin}},[t._v("登  录")]),t._v(" "),a("div",{staticClass:"forgetPwd"},["pwdLogin"==t.currentMethod?a("router-link",{attrs:{to:"/user/forgetPwd/inputNumber"}},[t._v("忘记密码？")]):a("div",{staticClass:"code-login"})],1),t._v(" "),t.showRegister?a("div",{staticClass:"toRegister"},[a("p",[t._v("没有账号，")]),t._v(" "),a("router-link",{attrs:{to:"/user/register"}},[t._v("去注册")]),t._v(" "),t._m(1)],1):t._e()]),t._v(" "),t.showCaptcha?a("captcha-box",{attrs:{captchaToken:t.captchaToken},on:{verifySuccess:t.verifySuccess,hideCaptcha:t.hideCaptcha}}):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("h2",[this._v("欢迎使用一键康"),e("span",{staticClass:"hos-port"},[this._v("医院端")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",[e("img",{attrs:{src:a("uPhU")}})])}]};var r=a("Z0/y")(o,n,!1,function(t){a("lT3O")},"data-v-ac0a3ee2",null);e.default=r.exports},lT3O:function(t,e){}});
//# sourceMappingURL=12.c3de2ed4ea8f67a679f7.js.map